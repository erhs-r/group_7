---
title: "UFO Sightings and COVID-19"
author: "Group 7 - Evan Conaway, James Seidel, Sarah Derda"
runtime: shiny
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
    theme: cerulean
---

```{r libraries/setup, include = FALSE}

library(flexdashboard)
library(readr)
library(lubridate)
library(shiny)
library(jsonlite)
library(maptools)
library(ggplot2)
library(tidyr)
library(dplyr)
library(purrr)
library(leaflet)
library(plotly)
library(DT)
library(ggthemes)
library(viridis)
library(raster)
library(tidyverse)
library(usmap)
library(ggmap)
library(maps)
library(readxl)
library(ggrepel)
library(gridExtra)
library(dplyr)

```

```{r data import, include = FALSE}

cases_pop_county <- read.csv("raw-data/counties_pop_casew.csv")
ufo <- read.csv("raw-data/ufo_withlatlong.csv")
USA <- getData("GADM", country = "usa", level = 2)

popup_dat <- paste0("<strong>County: </strong>", 
                    cases_pop_county$county, 
                    "<br><strong>Cases Per 100,000: </strong>", 
                    floor(cases_pop_county$casepercap))

popup_ufo <- paste0("<strong>Description: </strong>", 
                      ufo$Description)

```

### Frame 1 {data-commentary-width=350}

```{r interactive map}

pal <- colorQuantile("YlOrRd", NULL, n = 9)
leaflet() %>% 
  addTiles() %>% 
  fitBounds(-102.03,37,-109.03, 41) %>% 
  addTiles() %>% 
  addPolygons(data = USA,
              fillColor = ~pal(cases_pop_county$casepercap), 
              fillOpacity = 0.6, 
              color = "#BDBDC3", 
              weight = 1,
              popup = popup_dat) %>% 
  addMarkers(ufo$lon, 
             ufo$lat, 
             clusterOptions = markerClusterOptions(),
             icon = makeIcon("alien.png"),
             popup = popup_ufo) %>% 
  addLegend(position = "bottomleft", pal = pal, values = cases_pop_county$casepercap,
            title = "Cases per 100,000",
            opacity = 1)

```

*** 

Some commentary about Frame 1.

### Frame 2 {data-commentary-width=350}

```{r scatterplots}

###This script is for a side-by-side scatterplot of covid cases by state

# Read in data
covidbycounty <- read_csv("JamesWork/counties_pop_casew.xlsx") 
covid <- read_csv("raw-data/covidcases.csv")
ufobycounty <- read_csv("JamesWork/ufo2019counties") 

#isolated county, but couldnt get fips to work so stopped
#dont think county will be great anyway, too few data points compared to counties
ufobycounty<- drop_na(ufobycounty)
justcounty <- gsub(".*,","",ufobycounty$county)

ufobycounty <- ufobycounty %>% 
  mutate(County = justcounty) %>% 
  dplyr::select(-county)

#prepared data

ufobystate <- ufobycounty %>% 
  group_by(State) %>% 
  count() %>% 
  ungroup()

ufobystate <- mutate(.data = ufobystate, state_name = c("Alabama", "Arizona", 
                                          "Arkansas", "California", "Colorado", 
                                          "Connecticut", "Delaware", 
                                          "Florida", "Georgia","Idaho", 
                                          "Illinois", "Indiana", "Iowa", "Kansas", 
                                          "Kentucky", "Louisiana", "Maine", 
                                          "Maryland", "Massachusetts", "Michigan", 
                                          "Minnesota",
                                          "Mississippi", "Missouri", "Montana", 
                                          "Nebraska", "Nevada", "New Hampshire", 
                                          "New Jersey", "New Mexico", "New York", 
                                          "North Carolina", "North Dakota",
                                          "Ohio", "Oklahoma", "Oregon", "Pennsylvania",
                                          "Rhode Island", "South Carolina", "South Dakota", 
                                          "Tennessee", "Texas","Utah", "Vermont", 
                                          "Virginia", "Washington", "West Virginia", 
                                          "Wisconsin", "Wyoming"))

covidbystate <- covid %>% 
  group_by(state) %>% 
  count() %>% 
  ungroup() 

covidbystate <- covidbystate[-c(2, 9, 12, 13, 37, 42, 50),]

statepopulations <- read_excel("JamesWork/Statepopulations.xlsx")

ufoandcovid <- ufobystate %>%
  mutate(covid_cases = covidbystate$n) %>% 
  mutate(ufo_sightings = ufobystate$n) %>% 
  mutate(population = statepopulations$Population) %>% 
  mutate(covid_per_cap = covid_cases/population) %>% 
  mutate(ufo_per_cap = ufo_sightings/population)

##ggplots with data

plotone <- ufoandcovid %>% 
ggplot(aes(x=ufo_sightings, y = covid_cases)) +
  geom_point() +
  geom_text_repel(label = ufoandcovid$State, size = 2) +
  labs(x = "UFO sightings", y = "Covid cases", 
       title = "2020 Covid cases by 2019 UFO sightings in the lower 48 states (per capita on right)")+
  theme_tufte()

plottwo <- ufoandcovid %>% 
  ggplot(aes(x=ufo_per_cap, y = covid_per_cap)) +
  geom_point() +
  geom_text_repel(label = ufoandcovid$State, size = 2) +
  labs(x = "UFO sightings per capita", y = "Covid Cases per capita")+
  theme_tufte() +
  theme(axis.text.x = element_blank(), axis.ticks = element_blank(),
        axis.text.y = element_blank())

##final product

final_plot <- grid.arrange(plotone, plottwo, ncol = 2)

```

*** 

Some commentary about Frame 2.

### Frame 3 {data-commentary-width=350}

```{r death table}

### This script is designed to create the data table for our flex dashboard.
### It is a table of all the Covid Deaths. It is included to remind us of everyone that has passed due 
### to this pandemic. 

covid <- read_csv("raw-data/covidcases.csv")

covid <- covid %>% 
  dplyr::select(-fips, -cases) %>% 
  dplyr::filter(deaths == 1)%>% 
  dplyr::select(-deaths)

### This code chunk works better when knit into flexdashboard

datatable(covid, 
          colnames = c("Date", "County", "State"), 
          extensions = "Scroller", style="bootstrap", 
          class="compact", width="100%", 
          options=list(deferRender=TRUE, scrollY=300, scroller=TRUE))

```

***

Some commentary about Frame 3.
